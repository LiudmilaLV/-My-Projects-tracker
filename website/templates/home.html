{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
    <section class="container-lg my-1" id="greet">
        <div class="container-lg my-3">
            {% if not user.projects %}
            <!-- If User does'n have any projects-->
                <div class="row justify-content-around">
                    <div class="col-4 text-center">
                        <div class="display-3">Hi, {{user.name}}!</div>
                        <div class="display-6 text-muted">No projects yet?</div>
                    </div>
                    <div class="col-8 text-center">
                        <div class="display-3">Welcome to the Project Tracker!</div>
                        <!-- <div class="display-6 text-muted">Here is how it works:</div>
                        Carousel ? -->
                    </div>
                </div>
                <div class="m-5"><a href="#addproject" class="btn btn-lg btn-primary my-5">Add a new project to track</a></div>
            {% else %} 
            <!-- If User has projects -->
            <div class="container-lg my-3">
                <div class="row justify-content-around">
                    <div class="col-md-5 align-content-around justify-content-around">
                        <div class="display-2">Hi, {{user.name}}!</div>
                        <div class="display-6">Your current projects:</div>
                            {% for project in user.projects %}
                                <div class="btn mb-2">
                                    <a href="{{ url_for('views.project', project_id=project.id) }}">
                                        {{project.project_name}}
                                    </a>
                                </div>
                            {% endfor %}
                    </div>
                    <!-- Pie Chart -->
                    <div class="col-xs-10 col-sm-6 col-md-5">
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="chart">
                                    <canvas id="projects_pie"></canvas>
                                </div>
                            </div>    
                        </div>
                    </div>
                </div>
                <div class="m-5"><a href="#addproject" class="btn btn-lg btn-primary my-5">Add a new project to track</a></div>
            {% endif %}
        </div>
    </section>

    <section id="addproject">
        <div class="container-lg my-3">
            <form method="POST" action="#">
                {{ project_form.hidden_tag() }}
                <fieldset class="form-group">
                    <legend>Add a New Project</legend>
                    <div class="form-group">
                        {{ project_form.project_name.label(class="form-label mt-4") }}
                        {% if project_form.project_name.errors %}
                            {{ project_form.project_name(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in project_form.project_name.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ project_form.project_name(class="form-control") }}
                        {% endif %} 
                    </div>
                    <div class="form-group">
                        {{ project_form.notes.label(class="form-label mt-4") }}
                        {% if project_form.notes.errors %}
                            {{ project_form.notes(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in project_form.notes.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ project_form.notes(class="form-control") }}
                        {% endif %}
                    </div>
                </fieldset>
                <br>
                <div class="form-group">
                    {{ project_form.submit(class="btn btn-primary") }}
                </div>
            </form>
        </div>
    </section>
{% block javascript %}
<script>
    let u_p_labels = JSON.parse({{ user_projects_labels | tojson }})
    let u_p_data = JSON.parse('{{ user_projects_data }}')

    const pie_data = {
    labels: u_p_labels,
    datasets: [{
    data: u_p_data,
    backgroundColor: [
        'rgb(117, 189, 187)',
        'rgb(110, 79, 135)',
        'rgb(189, 117, 120)',
        'rgb(98, 113, 162)',
        'rgb(162, 98, 146)'
    ],
    hoverOffset: 10
    }]
    };
    const pie_config = {
        type: 'pie',
        data: pie_data,
        };

    const projects_pie_chart = new Chart(document.getElementById('projects_pie'), pie_config);

</script>
{% endblock %}
{% endblock %}